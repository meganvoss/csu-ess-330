[
  {
    "objectID": "lab-02.html",
    "href": "lab-02.html",
    "title": "lab-02",
    "section": "",
    "text": "Question 1\n\nremotes::install_github(\"ropensci/USAboundaries\")\n\nUsing github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.\n\n\nSkipping install of 'USAboundaries' from a github remote, the SHA1 (0f56f492) has not changed since last install.\n  Use `force = TRUE` to force installation\n\nremotes::install_github(\"ropensci/USAboundariesData\")\n\nUsing github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.\n\n\nSkipping install of 'USAboundariesData' from a github remote, the SHA1 (064cdbcb) has not changed since last install.\n  Use `force = TRUE` to force installation\n\nremotes::install_github(\"mikejohnson51/AOI\")\n\nUsing github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.\n\n\nSkipping install of 'AOI' from a github remote, the SHA1 (f821d499) has not changed since last install.\n  Use `force = TRUE` to force installation\n\nremotes::install_github(\"ropenscilabs/rnaturalearthdata\")\n\nUsing github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.\n\n\nSkipping install of 'rnaturalearthdata' from a github remote, the SHA1 (ff4d891f) has not changed since last install.\n  Use `force = TRUE` to force installation\n\n\n\n# spatial data science\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(units)\n\nudunits database from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/units/share/udunits/udunits2.xml\n\n# Data\nlibrary(AOI)\n\n# Visualization\nlibrary(gghighlight)\nlibrary(ggrepel)\nlibrary(knitr)\n\n\neqdc &lt;- '+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs'\n\n\naoi_get(country = c(\"MX\", \"CA\", \"USA\"))\n\nSimple feature collection with 3 features and 168 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -171.7911 ymin: 14.53883 xmax: -52.6481 ymax: 83.23324\nGeodetic CRS:  WGS 84\n        featurecla scalerank labelrank               sovereignt sov_a3 adm0_dif\n4  Admin-0 country         1         2                   Canada    CAN        0\n5  Admin-0 country         1         2 United States of America    US1        1\n28 Admin-0 country         1         2                   Mexico    MEX        0\n   level              type tlc                    admin adm0_a3 geou_dif\n4      2 Sovereign country   1                   Canada     CAN        0\n5      2           Country   1 United States of America     USA        0\n28     2 Sovereign country   1                   Mexico     MEX        0\n                    geounit gu_a3 su_dif       subunit su_a3 brk_diff\n4                    Canada   CAN      0        Canada   CAN        0\n5  United States of America   USA      0 United States   USA        0\n28                   Mexico   MEX      0        Mexico   MEX        0\n                       name     name_long brk_a3      brk_name brk_group abbrev\n4                    Canada        Canada    CAN        Canada      &lt;NA&gt;   Can.\n5  United States of America United States    USA United States      &lt;NA&gt; U.S.A.\n28                   Mexico        Mexico    MEX        Mexico      &lt;NA&gt;   Mex.\n   postal                formal_en formal_fr    name_ciawf note_adm0 note_brk\n4      CA                   Canada      &lt;NA&gt;        Canada      &lt;NA&gt;     &lt;NA&gt;\n5      US United States of America      &lt;NA&gt; United States      &lt;NA&gt;     &lt;NA&gt;\n28     MX    United Mexican States      &lt;NA&gt;        Mexico      &lt;NA&gt;     &lt;NA&gt;\n                  name_sort name_alt mapcolor7 mapcolor8 mapcolor9 mapcolor13\n4                    Canada     &lt;NA&gt;         6         6         2          2\n5  United States of America     &lt;NA&gt;         4         5         1          1\n28                   Mexico     &lt;NA&gt;         6         1         7          3\n     pop_est pop_rank pop_year   gdp_md gdp_year                  economy\n4   37589262       15     2019  1736425     2019  1. Developed region: G7\n5  328239523       17     2019 21433226     2019  1. Developed region: G7\n28 127575529       17     2019  1268870     2019 4. Emerging region: MIKT\n               income_grp fips_10 iso_a2 iso_a2_eh iso_a3 iso_a3_eh iso_n3\n4    1. High income: OECD      CA     CA        CA    CAN       CAN    124\n5    1. High income: OECD      US     US        US    USA       USA    840\n28 3. Upper middle income      MX     MX        MX    MEX       MEX    484\n   iso_n3_eh un_a3 wb_a2 wb_a3   woe_id woe_id_eh                   woe_note\n4        124   124    CA   CAN 23424775  23424775 Exact WOE match as country\n5        840   840    US   USA 23424977  23424977 Exact WOE match as country\n28       484   484    MX   MEX 23424900  23424900 Exact WOE match as country\n   adm0_iso adm0_diff adm0_tlc adm0_a3_us adm0_a3_fr adm0_a3_ru adm0_a3_es\n4       CAN      &lt;NA&gt;      CAN        CAN        CAN        CAN        CAN\n5       USA      &lt;NA&gt;      USA        USA        USA        USA        USA\n28      MEX      &lt;NA&gt;      MEX        MEX        MEX        MEX        MEX\n   adm0_a3_cn adm0_a3_tw adm0_a3_in adm0_a3_np adm0_a3_pk adm0_a3_de adm0_a3_gb\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_br adm0_a3_il adm0_a3_ps adm0_a3_sa adm0_a3_eg adm0_a3_ma adm0_a3_pt\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_ar adm0_a3_jp adm0_a3_ko adm0_a3_vn adm0_a3_tr adm0_a3_id adm0_a3_pl\n4         CAN        CAN        CAN        CAN        CAN        CAN        CAN\n5         USA        USA        USA        USA        USA        USA        USA\n28        MEX        MEX        MEX        MEX        MEX        MEX        MEX\n   adm0_a3_gr adm0_a3_it adm0_a3_nl adm0_a3_se adm0_a3_bd adm0_a3_ua adm0_a3_un\n4         CAN        CAN        CAN        CAN        CAN        CAN        -99\n5         USA        USA        USA        USA        USA        USA        -99\n28        MEX        MEX        MEX        MEX        MEX        MEX        -99\n   adm0_a3_wb     continent region_un        subregion\n4         -99 North America  Americas Northern America\n5         -99 North America  Americas Northern America\n28        -99 North America  Americas  Central America\n                   region_wb name_len long_len abbrev_len tiny homepart\n4              North America        6        6          4  -99        1\n5              North America       24       13          6  -99        1\n28 Latin America & Caribbean        6        6          4  -99        1\n   min_zoom min_label max_label   label_x  label_y      ne_id wikidataid\n4         0       1.7       5.7 -101.9107 60.32429 1159320467        Q16\n5         0       1.7       5.7  -97.4826 39.53848 1159321369        Q30\n28        0       2.0       6.7 -102.2894 23.91999 1159321055        Q96\n            name_ar         name_bn            name_de                  name_en\n4              كندا          কানাডা             Kanada                   Canada\n5  الولايات المتحدة মার্কিন যুক্তরাষ্ট্র Vereinigte Staaten United States of America\n28          المكسيك         মেক্সিকো             Mexiko                   Mexico\n          name_es             name_fa    name_fr                     name_el\n4          Canadá              کانادا     Canada                     Καναδάς\n5  Estados Unidos ایالات متحده آمریکا États-Unis Ηνωμένες Πολιτείες Αμερικής\n28         México               مکزیک    Mexique                      Μεξικό\n       name_he          name_hi                   name_hu         name_id\n4         קנדה            कनाडा                    Kanada          Kanada\n5  ארצות הברית संयुक्त राज्य अमेरिका Amerikai Egyesült Államok Amerika Serikat\n28      מקסיקו           मेक्सिको                    Mexikó         Meksiko\n                 name_it        name_ja name_ko                      name_nl\n4                 Canada         カナダ  캐나다                       Canada\n5  Stati Uniti d'America アメリカ合衆国    미국 Verenigde Staten van Amerika\n28               Messico       メキシコ  멕시코                       Mexico\n             name_pl        name_pt name_ru name_sv                     name_tr\n4             Kanada         Canadá  Канада  Kanada                      Kanada\n5  Stany Zjednoczone Estados Unidos     США     USA Amerika Birleşik Devletleri\n28            Meksyk         México Мексика  Mexiko                     Meksika\n                   name_uk                name_ur name_vi name_zh name_zht\n4                   Канада                 کینیڈا  Canada  加拿大   加拿大\n5  Сполучені Штати Америки ریاستہائے متحدہ امریکا  Hoa Kỳ    美国     美國\n28                 Мексика                میکسیکو  México  墨西哥   墨西哥\n        fclass_iso tlc_diff      fclass_tlc fclass_us fclass_fr fclass_ru\n4  Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5  Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28 Admin-0 country     &lt;NA&gt; Admin-0 country      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_es fclass_cn fclass_tw fclass_in fclass_np fclass_pk fclass_de\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_gb fclass_br fclass_il fclass_ps fclass_sa fclass_eg fclass_ma\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_pt fclass_ar fclass_jp fclass_ko fclass_vn fclass_tr fclass_id\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n   fclass_pl fclass_gr fclass_it fclass_nl fclass_se fclass_bd fclass_ua\n4       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n5       &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n28      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;      &lt;NA&gt;\n                         geometry\n4  MULTIPOLYGON (((-122.84 49,...\n5  MULTIPOLYGON (((-122.84 49,...\n28 MULTIPOLYGON (((-117.1278 3...\n\neqdc &lt;- st_crs(5070)\n\ncountries &lt;- rnaturalearth::countries110 |&gt;\n  st_transform(eqdc)\n\nstates &lt;- USAboundaries::us_states(resolution = \"low\") |&gt;\n  filter(!state_abbr %in% c(\"HI\", \"AK\", \"PR\")) |&gt;\n  st_transform(eqdc)\n\n\nlibrary(readr)\n\ncities &lt;- read_csv(\"data/uscities.csv\", show_col_types = FALSE) |&gt;\n  st_as_sf(coords = c(\"lng\", \"lat\"), crs = 4326) |&gt;\n  st_transform(eqdc)\n\n\n\nQuestion 2\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(units)\nlibrary(USAboundaries)\nlibrary(rnaturalearth)\nlibrary(flextable)\n\n\nAttaching package: 'flextable'\n\n\nThe following object is masked from 'package:purrr':\n\n    compose\n\neqdc &lt;- \"+proj=eqdc +lat_0=40 +lon_0=-96 +lat_1=20 +lat_2=60 +x_0=0 +y_0=0 +datum=NAD83 +units=m +no_defs\"\n\nstates &lt;- USAboundaries::us_states(resolution = \"low\") %&gt;%\n  filter(!state_abbr %in% c(\"HI\", \"AK\", \"PR\")) %&gt;%\n  st_transform(eqdc)\n\ncountries &lt;- rnaturalearth::ne_countries(scale = \"medium\", returnclass = \"sf\") %&gt;%\n  st_transform(eqdc)\n\ncities &lt;- read_csv(\"data/uscities.csv\", show_col_types = FALSE) %&gt;%\n  st_as_sf(coords = c(\"lng\", \"lat\"), crs = 4326) %&gt;%\n  st_transform(eqdc)\n\n\n\n2.1\n\nstate_lines_unresolved &lt;- states |&gt; st_cast(\"MULTILINESTRING\")\n\ndist_matrix &lt;- st_distance(cities, state_lines_unresolved)\n\ncities$dist_to_state &lt;- apply(dist_matrix, 1, min) |&gt; set_units(\"km\") |&gt; drop_units()\n\ncities |&gt; \n  arrange(desc(dist_to_state)) |&gt; \n  slice(1:5) |&gt; \n  select(city, state_name, dist_to_state) |&gt; \n  flextable()\n\ncitystate_namedist_to_stategeometryAttu StationAlaska4,126,436[[XY]]Eareckson StationAlaska4,068,558[[XY]]KekahaHawaii3,768,352[[XY]]KaumakaniHawaii3,764,958[[XY]]Pakala VillageHawaii3,764,612[[XY]]\n\n\n\n\n2.2\n\nusa_border &lt;- states |&gt; st_union() |&gt; st_cast(\"MULTILINESTRING\")\n\ndist_matrix_us &lt;- st_distance(cities, usa_border)\n\ncities$dist_to_us_border &lt;- apply(dist_matrix_us, 1, min) |&gt; set_units(\"km\") |&gt; drop_units()\n\ncities |&gt; \n  arrange(desc(dist_to_us_border)) |&gt; \n  slice(1:5) |&gt; \n  select(city, state_name, dist_to_us_border) |&gt; \n  flextable()\n\ncitystate_namedist_to_us_bordergeometryAttu StationAlaska4,126,436[[XY]]Eareckson StationAlaska4,068,558[[XY]]KekahaHawaii3,768,352[[XY]]KaumakaniHawaii3,764,958[[XY]]Pakala VillageHawaii3,764,612[[XY]]\n\n\n\n\nQuestion 3\n\n\n3.1\n\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(gghighlight)\n\n# Top 10 cities by population\ntop10 &lt;- cities |&gt; \n  slice_max(order_by = population, n = 10)\n\nggplot() +\n  geom_sf(data = countries, fill = \"gray95\", color = \"black\") +\n  geom_sf(data = states, fill = NA, color = \"gray40\", lty = 2) +\n  geom_sf(data = cities, color = \"blue\", size = 0.5) +\n  geom_label_repel(\n    data = top10,\n    aes(geometry = geometry, label = city),\n    stat = \"sf_coordinates\",\n    size = 3\n  ) +\n  theme_minimal()\n\nWarning: ggrepel: 10 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps\n\n\n\n\n\n\n\n\n\n\n\n3.2\n\nfar_us_border &lt;- cities |&gt; slice_max(dist_to_us_border, n = 5)\n\nggplot() +\n  geom_sf(data = countries, fill = \"gray95\", color = \"black\") +\n  geom_sf(data = states, fill = NA, color = \"gray40\", lty = 2) +\n  geom_sf(data = cities, aes(color = dist_to_us_border), size = 0.7) +\n  scale_color_viridis_c(option = \"C\") +\n  geom_label_repel(\n    data = far_us_border,\n    aes(geometry = geometry, label = city),\n    stat = \"sf_coordinates\",\n    size = 3\n  ) +\n  labs(color = \"Distance to National Border (km)\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n3.3\n\nfar_state_border &lt;- cities |&gt; slice_max(dist_to_state, n = 5)\n\nggplot() +\n  geom_sf(data = countries, fill = \"gray95\", color = \"black\") +\n  geom_sf(data = states, fill = NA, color = \"gray40\", lty = 2) +\n  geom_sf(data = cities, aes(color = dist_to_state), size = 0.7) +\n  scale_color_viridis_c(option = \"D\") +\n  geom_label_repel(\n    data = far_state_border,\n    aes(geometry = geometry, label = city),\n    stat = \"sf_coordinates\",\n    size = 3\n  ) +\n  labs(color = \"Distance to State Border (km)\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\n3.4\n\nmexico_border &lt;- countries |&gt; \n  filter(admin == \"Mexico\") |&gt; \n  st_cast(\"MULTILINESTRING\")\n\ndist_matrix_mexico &lt;- st_distance(cities, mexico_border)\n\ncities$dist_to_mexico &lt;- apply(dist_matrix_mexico, 1, min) |&gt;\n  set_units(\"km\") |&gt; drop_units()\n\n\ncanada_border &lt;- countries |&gt; \n  filter(admin == \"Canada\") |&gt; \n  st_cast(\"MULTILINESTRING\")\n\ndist_matrix_canada &lt;- st_distance(cities, canada_border)\n\ncities$dist_to_canada &lt;- apply(dist_matrix_canada, 1, min) |&gt;\n  set_units(\"km\") |&gt; drop_units()\n\n\ncities &lt;- cities |&gt; \n  mutate(can_mex_diff = abs(dist_to_canada - dist_to_mexico))\n\nequidistant_zone &lt;- cities |&gt; \n  filter(can_mex_diff &lt;= 100)\n\ntop5_equal_dist &lt;- equidistant_zone |&gt; \n  slice_max(order_by = population, n = 5)\n\nggplot() +\n  geom_sf(data = countries, fill = \"gray95\", color = \"black\") +\n  geom_sf(data = states, fill = NA, color = \"gray60\", lty = 2) +\n  geom_sf(data = cities, color = \"gray80\", size = 0.3) +\n  geom_sf(data = equidistant_zone, aes(color = can_mex_diff), size = 1) +\n  gghighlight(use_direct_label = FALSE) +\n  geom_label_repel(\n    data = top5_equal_dist,\n    aes(geometry = geometry, label = city),\n    stat = \"sf_coordinates\",\n    size = 3\n  ) +\n  scale_color_viridis_c(option = \"E\") +\n  labs(title = \"Cities Equidistant (±100km) from Canada & Mexico\",\n       color = \"Distance Difference (km)\") +\n  theme_minimal()\n\n\n\n\n\n\n\n\n\n\nQuestion 4\n\n\n4.1\n\ncities &lt;- cities |&gt; \n  mutate(in_danger_zone = dist_to_us_border &lt;= 160)\n\ndanger_zone_count &lt;- sum(cities$in_danger_zone)\n\ndanger_zone_count\n\n[1] 31\n\n\n\n\n4.2\n\ntotal_pop &lt;- sum(cities$population, na.rm = TRUE)\ndanger_zone_pop &lt;- sum(cities$population[cities$in_danger_zone], na.rm = TRUE)\n\ndanger_zone_pct &lt;- (danger_zone_pop / total_pop) * 100\n\ntibble(\n  `Total Cities` = nrow(cities),\n  `Cities in Danger Zone` = danger_zone_count,\n  `Danger Zone Population` = danger_zone_pop,\n  `Total Population` = total_pop,\n  `Percent of Population in Zone` = round(danger_zone_pct, 1)\n) |&gt; \n  flextable()\n\nTotal CitiesCities in Danger ZoneDanger Zone PopulationTotal PopulationPercent of Population in Zone31,2543173,073402,301,8540\n\n\n\n\n4.3\n\nlibrary(scales)  \n\n\nAttaching package: 'scales'\n\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n\ntop10_danger_zone &lt;- cities |&gt; \n  filter(in_danger_zone) |&gt; \n  slice_max(order_by = population, n = 10)\n\nggplot() +\n  geom_sf(data = countries, fill = \"gray90\", color = \"black\") +\n  geom_sf(data = states, fill = NA, color = \"gray40\", lty = 2) +\n  geom_sf(data = cities |&gt; filter(in_danger_zone),\n          aes(color = population), size = 0.8) +\n  scale_color_gradient(low = \"orange\", high = \"darkred\", labels = comma) +\n  geom_label_repel(\n    data = top10_danger_zone,\n    aes(geometry = geometry, label = city),\n    stat = \"sf_coordinates\",\n    size = 3\n  ) +\n  labs(\n    title = \"Top 10 Most Populous Cities in the Danger Zone\",\n    color = \"Population\"\n  ) +\n  theme_minimal()\n\nWarning: ggrepel: 10 unlabeled data points (too many overlaps). Consider\nincreasing max.overlaps"
  }
]